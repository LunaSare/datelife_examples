get_best_grove(datelife_result = tax_drall[[i]])),
tax_medianmatrixall = lapply(seq(length(taxa)), function(i)
datelife_result_median_matrix(tax_bestgroveall[[i]]$best_grove)),
tax_phyclustermedianall = lapply(tax_medianmatrixall, cluster_patristicmatrix),
tax_sdmmatrixall = lapply(tax_bestgroveall[[i]]$best_grove, get_sdm_matrix),
tax_phyclustersdmall = lapply(tax_sdmmatrixall, cluster_patristicmatrix)
)
make(plan_summ)
plan_summ <- drake_plan(
tax_bestgroveall = lapply(seq(length(taxa)), function(i)
get_best_grove(datelife_result = tax_drall[[i]])),
tax_medianmatrixall = lapply(seq(length(taxa)), function(i)
datelife_result_median_matrix(tax_bestgroveall[[i]]$best_grove)),
tax_phyclustermedianall = lapply(tax_medianmatrixall, cluster_patristicmatrix),
tax_sdmmatrixall = lapply(seq(length(taxa)), function(i)
get_sdm_matrix(tax_bestgroveall[[i]]$best_grove)),
tax_phyclustersdmall = lapply(tax_sdmmatrixall, cluster_patristicmatrix)
)
make(plan_summ)
source("R/plan_report.R")
make(Cetacea)
source("R/plan_report.R")
source("R/plan_report.R")
source("R/global_functions.R")
source("R/plan_report.R")
source("R/plan_report.R")
source("R/global_functions.R")
source("R/multi2di_test.R")
source("R/plan_report.R")
loadd(sdm2phylo_bladj)
sdm2phylo_bladj
source("R/plan_report.R")
utils::data(subset2_taxa)
unique(subset2_taxa)
length(subset2_taxa)
length(unqiue(subset2_taxa))
length(unique(subset2_taxa))
seq_along(taxaall)
taxaall <- c("Spheniscidae","Cetacea", "Fringilidae", "Hominidae", "Phyllostomidae", "Anolis", "Primates")
seq_along(taxaall)
source("R/plan.R")
i
tax_phyclustermed
# sapply(tax_datedotolall[[5]], is.binary) none of them are binary and yet they are fully plotted with plotSimmap
# # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #
loadd(taxa)
tax_median_phyloall = lapply(seq(length(taxa)), function(i)
summarize_datelife_result(
datelife_query = tax_dqall[[i]],
datelife_result = tax_drall[[i]],
summary_format = "phylo_median",
taxon_summary = "summary"))
i
tax_median_phyloall[[i]]
names(tax_median_phyloall[[i]])
source("R/functions_plotting.R")
make_lttplot_summ(taxon, tax_phyloall, tax_datedotol,
tax_phylosummary = tax_sdm_phyloall[[i]],
tax_phycluster = tax_sdm_phyclusterall[[i]],
legend_phylosumm = "SDM",
col_phylosummary = "blue")
source("R/global_functions.R")
source("R/global_packages.R")
make_lttplot_summ(taxon, tax_phyloall, tax_datedotol,
tax_phylosummary = tax_sdm_phyloall[[i]],
tax_phycluster = tax_sdm_phyclusterall[[i]],
legend_phylosumm = "SDM",
col_phylosummary = "blue")
loadd(taxa)
loadd(tax_dqall)
loadd(tax_drall)
make_lttplot_summ(taxon, tax_phyloall, tax_datedotol,
tax_phylosummary = tax_sdm_phyloall[[i]],
tax_phycluster = tax_sdm_phyclusterall[[i]],
legend_phylosumm = "SDM",
col_phylosummary = "blue")
make_lttplot_summ(taxa[i], tax_phyloall, tax_datedotol,
tax_phylosummary = tax_sdm_phyloall[[i]],
tax_phycluster = tax_sdm_phyclusterall[[i]],
legend_phylosumm = "SDM",
col_phylosummary = "blue")
tax_phyloall = tax_phyloallall[[i]]
make_lttplot_summ(taxa[i], tax_phyloall, tax_datedotol,
tax_phylosummary = tax_sdm_phyloall[[i]],
tax_phycluster = tax_sdm_phyclusterall[[i]],
legend_phylosumm = "SDM",
col_phylosummary = "blue")
tax_datedotol = tax_datedotolall[[i]]
make_lttplot_summ(taxa[i], tax_phyloall, tax_datedotol,
tax_phylosummary = tax_sdm_phyloall[[i]],
tax_phycluster = tax_sdm_phyclusterall[[i]],
legend_phylosumm = "SDM",
col_phylosummary = "blue")
tax_sdm_phyloall = lapply(seq(length(taxa)), function(i)
summarize_datelife_result(
datelife_query = tax_dqall[[i]],
datelife_result = tax_drall[[i]],
summary_format = "phylo_sdm",
taxon_summary = "none"))
loadd(tax_sdm_phyloall)
make_lttplot_summ(taxa[i], tax_phyloall, tax_datedotol,
tax_phylosummary = tax_sdm_phyloall[[i]],
tax_phycluster = tax_sdm_phyclusterall[[i]],
legend_phylosumm = "SDM",
col_phylosummary = "blue")
loadd(tax_sdm_phyclusterall)
loadd(tax_sdm_phyclusterall)
loadd(tax_median_phyloall)
loadd(taxa)
loadd(tax_dqall)
loadd(tax_drall)
loadd(tax_summall)
loadd(tax_phyloallall)
loadd(tax_datedotolall)
loadd(tax_treefromtaxall)  # it errors only with CoL now (segfault) length(tax_treefromtaxall)
loadd(tax_otolall)
loadd(tax_allcalall)
loadd(tax_allcal_datedotolall)
loadd(tax_crossvalall)
# loadd(tax_crossval2all)
loadd(tax_eachcalall)
loadd(tax_eachcal_datedotolall)
# loadd(tax_med_bladjall)
# loadd(tax_sdm_bladjall)
loadd(tax_median_matrixall)
loadd(tax_median_phyclusterall)
loadd(tax_median_phyloall)
loadd(tax_sdm_matrixall)
loadd(tax_sdm_phyclusterall)
loadd(tax_sdm_phyloall)
i
make_lttplot_summ(taxa[i], tax_phyloall, tax_datedotol,
tax_phylosummary = tax_sdm_phyloall[[i]],
tax_phycluster = tax_sdm_phyclusterall[[i]],
legend_phylosumm = "SDM",
col_phylosummary = "blue")
taxa[i]
source("R/functions_plotting.R")
loadd(tax_datedotolall)
loadd(tax_eachcalall)
i
tax_datedotolall[[i]]
tax_datedotolall[[1]]
sapply(tax_datedotolall, is.na)
sapply(tax_dqall, is.na)
sapply(tax_dqall, function(x) length(x$cleaned_names))
i
get_dated_otol_induced_subtree(input = tax_dqall[[i]],
ott_id = tax_dqall[[i]]$ott_ids)
input_ott_match(input = tax_dqall[[i]],
ott_id = tax_dqall[[i]]$ott_ids)
check_ott_input(input = tax_dqall[[i]],
ott_id = tax_dqall[[i]]$ott_ids)
get_dated_otol_induced_subtree(input = tax_dqall[[i]],
ott_id = tax_dqall[[i]]$ott_ids)
get_dated_otol_induced_subtree(input = tax_dqall[[i]],
ott_id = tax_dqall[[i]]$ott_ids)
get_dated_otol_induced_subtree(input = tax_dqall[[i]],
ott_id = tax_dqall[[i]]$ott_ids)
make_lttplot_summ(taxa[i], tax_phyloall, tax_datedotol,
tax_phylosummary = tax_sdm_phyloall[[i]],
tax_phycluster = tax_sdm_phyclusterall[[i]],
legend_phylosumm = "SDM",
col_phylosummary = "blue")
get_dated_otol_induced_subtree(input = tax_dqall[[i]],
ott_id = tax_dqall[[i]]$ott_ids)
get_dated_otol_induced_subtree(input = tax_dqall[[i]],
ott_id = tax_dqall[[i]]$ott_ids)
make_lttplot_summ(taxa[i], tax_phyloall, tax_datedotol,
tax_phylosummary = tax_sdm_phyloall[[i]],
tax_phycluster = tax_sdm_phyclusterall[[i]],
legend_phylosumm = "SDM",
col_phylosummary = "blue",
summ_matrix = tax_sdm_matrixall[[i]])
tax_sdm_matrixall[[i]]
loadd(sdm_matrix)
which(sdm_matrix < 0)
list(SDM = 1, MEdian = 0)
tax_sdm_matrix = tax_sdm_matrixall[[i]]
tax_median_matrix = tax_median_matrixall[[i]]
knitr::opts_chunk$set(
collapse = TRUE,
comment = "#>"
)
my_table_format <- function(tt){
res <- format.data.frame(tt, digits = 4, nsmall = 4, justify = "none")
return(res)
}
library(microbenchmark)
loadd(taxon)
loadd(tax_dq)
loadd(tax_dr)
loadd(tax_summ)
loadd(tax_phyloall)
phyloall_success <- ape::is.ultrametric(tax_phyloall, option = 2)
loadd(tax_median_phylo)
setwd("/Users/luna/datelife_examples")
source("R/global_packages.R")
pkgconfig::set_config("drake::strings_in_dots" = "literals")
knitr::opts_knit$set(root.dir = "docs")
knitr::opts_knit$set(base.dir = "docs")
source("R/global_functions.R")
source("R/functions_plotting.R")
loadd(taxon)
loadd(tax_dq)
loadd(tax_dr)
loadd(tax_summ)
loadd(tax_phyloall)
phyloall_success <- ape::is.ultrametric(tax_phyloall, option = 2)
loadd(tax_median_phylo)
loadd(tax_sdm)
loadd(tax_sdm_matrix)
loadd(tax_datedotol)
loadd(tax_allcal_datedotol)
loadd(tax_otol)
loadd(tax_treefromtax)
loadd(tax_phyloall)
loadd(tax_eachcal_datedotol)
loadd(tax_crossval)
loadd(tax_phycluster)
loadd(sdm2phylo_bladj)
tax_sdm_matrix <- sdm_matrix
loadd(sdm_matrix)
tax_sdm_matrix <- sdm_matrix
tax_median_phyloall[[i]]$phylo_median
loadd(tax_median_phyloall)
loadd(taxa)
loadd(tax_dqall)
loadd(tax_drall)
loadd(tax_summall)
loadd(tax_phyloallall)
loadd(tax_datedotolall)
loadd(tax_treefromtaxall)  # it errors only with CoL now (segfault) length(tax_treefromtaxall)
loadd(tax_otolall)
loadd(tax_allcalall)
loadd(tax_allcal_datedotolall)
loadd(tax_crossvalall)
# loadd(tax_crossval2all)
loadd(tax_eachcalall)
loadd(tax_eachcal_datedotolall)
# loadd(tax_med_bladjall)
# loadd(tax_sdm_bladjall)
loadd(tax_median_matrixall)
loadd(tax_median_phyclusterall)
loadd(tax_median_phyloall)
loadd(tax_sdm_matrixall)
loadd(tax_sdm_phyclusterall)
loadd(tax_sdm_phyloall)
i=7
tax_median_matrix = tax_median_matrixall[[i]]
negs_list <- list(SDM = which(tax_sdm_matrix < 0),
Median = which(median_matrix < 0))
negs_list <- list(SDM = which(tax_sdm_matrix < 0),
Median = which(tax_median_matrix < 0))
for (negs in negs_list){
print(negs)
}
which(tax_sdm_matrix < 0)
is.na(tax_datedotolall)
all(is.na(tax_datedotolall))
lapply(seq(tax_datedotolall), function(i)
ape::compute.brlen(tax_otolall[[i]]))
i
make_lttplot_summ(taxa[i], tax_phyloall, tax_datedotol,
tax_phylosummary = tax_median_phyloall[[i]]$phylo_median,
tax_phycluster = tax_median_phyclusterall[[i]],
legend_phylosumm = "Median",
col_phylosummary = "orange",
summ_matrix = tax_median_matrixall[[i]])
source("R/functions_plotting.R")
make_lttplot_summ(taxa[i], tax_phyloall, tax_datedotol,
tax_phylosummary = tax_median_phyloall[[i]]$phylo_median,
tax_phycluster = tax_median_phyclusterall[[i]],
legend_phylosumm = "Median",
col_phylosummary = "orange",
summ_matrix = tax_median_matrixall[[i]])
getwd()
tax_datedotol
loadd(tax_sdm_phyclusterall)
tax_sdm_phyclusterall[[i]]
i
i=1
tax_median_phyloall[[i]]$phylo_median
make_lttplot_summ(taxa[i], tax_phyloall, tax_datedotol,
tax_phylosummary = tax_median_phyloall[[i]]$phylo_median,
tax_phycluster = tax_median_phyclusterall[[i]],
legend_phylosumm = "Median",
col_phylosummary = "orange",
summ_matrix = tax_median_matrixall[[i]])
make_lttplot_summ(taxa[i], tax_phyloall, tax_datedotol,
tax_phylosummary = tax_sdm_phyloall[[i]],
tax_phycluster = tax_sdm_phyclusterall[[i]],
legend_phylosumm = "SDM",
col_phylosummary = "blue",
summ_matrix = tax_sdm_matrixall[[i]])
tax_sdm_phyloall[[i]]
tax_sdm_phyclusterall[[i]]
tax_datedotolall[[i]]
if(all(is.na(tax_datedotolall))){
tax_datedotolall <- lapply(seq(tax_datedotolall), function(i)
ape::compute.brlen(tax_otolall[[i]]))
}
tax_datedotolall[[i]]
make_lttplot_summ(taxa[i], tax_phyloall, tax_datedotol,
tax_phylosummary = tax_median_phyloall[[i]]$phylo_median,
tax_phycluster = tax_median_phyclusterall[[i]],
legend_phylosumm = "Median",
col_phylosummary = "orange",
summ_matrix = tax_median_matrixall[[i]])
tax_sdm_phyloall[[i]]
col_phylosummary = "blue"
legend_phylosumm = "SDM"
tax_phycluster = tax_sdm_phyclusterall[[i]]
tax_phylosummary = tax_sdm_phyloall[[i]]
tax_phyloall
tax_datedotol
taxa[i]
# orange "#ffa500"
# blue
# as imple test to check that col_phylosummary is a valid color string, either character or hex:
is.hex <- tryCatch(suppressWarnings(plotrix::color.id(col_phylosummary)), error = function(e) FALSE)
is.hex
!inherits(is.hex, "logical")
col2hex(col_phylosummary)
col_phylosummary <- col2hex(col_phylosummary)
file_name = paste0("docs/plots/", taxon, "_", filename, legend_phylosumm, ".pdf")
filename = "LTTplot_"
file_name = paste0("docs/plots/", taxon, "_", filename, legend_phylosumm, ".pdf")
file_name
trees <- c(tax_phyloall, tax_datedotol)
inherits(tax_phylosummary, "phylo")
trees <- c(trees, tax_phylosummary)
trees
inherits(tax_phycluster, "list")
class(tax_phycluster) <- "multiPhylo"
trees <- c(trees, tax_phycluster)
inherits(sdm2phylo, "phylo")
sdm2phylo = NULL
inherits(sdm2phylo, "phylo")
trees <- trees[!sapply(trees, is.null)]
trees
max_age <- max(sapply(trees, function(x) max(ape::branching.times(x))))
max_tips <- max(sapply(trees, function(x) max(ape::Ntip(x))))
max_age
max_tips
tax_datedotol <- ape::collapse.singles(tax_datedotol)
tax_datedotol <- phytools::force.ultrametric(tax_datedotol)
col_datedotol <- "#808080" #gray
col_phyloall <- "#cce5ff" # light blue
col_nj <- "#ff3399"
col_upgma <- "#b266ff"
leg <- paste(taxon, c("Dated OToL", "Source Chronograms"))
cols <- c(col_datedotol, col_phyloall)
linetype <- c(1, 1)
y1 <- max_tips*0.05
y0 <- max_tips*0.15
lwd_arrows <- 2
length_arrowhead <- 0.075
ape::ltt.plot(tax_datedotol, xlim = c(-max_age, 0), ylim = c(0, max_tips),
col = paste0(col_datedotol, "80"), ylab = paste(taxon, "Species"),
xlab = "Time (myrs)")
x0 <- x1 <- -max(ape::branching.times(tax_datedotol))
arrows(x0, y0, x1, y1, length = length_arrowhead, col = paste0(col_datedotol, "80"), lwd = lwd_arrows)
# points(x = -max(ape::branching.times(tax_datedotol)),  y = 2, pch = 25, col = paste0(col_datedotol, "60"), lwd = 0.75)
for (i in seq(length(tax_phyloall))){
ape::ltt.lines(phy = tax_phyloall[[i]], col = paste0(col_phyloall, "80"))
# points(x = -max(ape::branching.times(tax_phyloall[[i]])),  y = 2, pch = 25, col = paste0(col_phyloall, "60"), lwd = 0.75)
x0 <- x1 <- -max(ape::branching.times(tax_phyloall[[i]]))
arrows(x0, y0, x1, y1, length = length_arrowhead, col = paste0(col_phyloall, "99"), lwd = lwd_arrows)
}
if(inherits(tax_phylosummary, "phylo")){
ape::ltt.lines(phy = tax_phylosummary, col = paste0(col_phylosummary, "80"))
x0 <- x1 <- -max(ape::branching.times(tax_phylosummary))
arrows(x0, y0, x1, y1, length = length_arrowhead, col = paste0(col_phylosummary, "80"), lwd = lwd_arrows)
leg <- c(leg, paste(legend_phylosumm, "Summary Chronogram"))
cols <- c(cols, col_phylosummary)
linetype <- c(linetype, 1)
}
if(inherits(tax_phycluster, "multiPhylo")){
for(i in seq(tax_phycluster)){
if(!is.null(tax_phycluster[[i]])){
if(any(grepl("nj", names(tax_phycluster[i])))){
col_sdm <- col_nj
}
if(any(grepl("upgma", names(tax_phycluster[i])))){
col_sdm <- col_upgma
}
ape::ltt.lines(phy = tax_phycluster[[i]], col = paste0(col_sdm, "80"))
# points(x = -max(ape::branching.times(tax_phycluster[[i]])), y = 2, pch = 25, col = paste0(col_sdm, "60"), lwd = 0.75)
x0 <- x1 <- -max(ape::branching.times(tax_phycluster[[i]]))
arrows(x0, y0, x1, y1, length = length_arrowhead, col = paste0(col_sdm, "80"), lwd = lwd_arrows)
leg <- c(leg, paste(taxon, legend_phylosumm, gsub("_", " ", toupper(names(tax_phycluster[i])))))
cols <- c(cols, col_sdm)
linetype <- c(linetype, 1)
}
}
}
negs_sdm
negs_sdm = which(tax_sdm_matrix < 0)
negs_sdm
length(negs) >0
knitr::opts_chunk$set(
collapse = TRUE,
comment = "#>"
)
my_table_format <- function(tt){
res <- format.data.frame(tt, digits = 4, nsmall = 4, justify = "none")
return(res)
}
library(microbenchmark)
loadd(taxon)
loadd(tax_dq)
loadd(tax_dr)
loadd(tax_summ)
loadd(tax_phyloall)
phyloall_success <- ape::is.ultrametric(tax_phyloall, option = 2)
loadd(tax_median_phylo)
loadd(tax_sdm_phylo)
loadd(tax_sdm_matrix)
loadd(tax_datedotol)
loadd(tax_allcal_datedotol)
loadd(tax_otol)
loadd(tax_treefromtax)
loadd(tax_phyloall)
loadd(tax_eachcal_datedotol)
loadd(tax_crossval)
loadd(tax_phycluster)
loadd(sdm2phylo_bladj)
# loadd(tax_crossval2)
fig_lttplot_sdm <- "Fig. 3"
fig_lttplot_median <- "Fig. 4"
figcap2 <- paste(taxon, "Species Tree from Taxonomy. This tree was obtained with `tree_from_taxonomy()` function.")
table_crossval <- "Table 2"
negs_list
rep(list(""), 2)
source("R/functions_plotting.R")
whale_query <- make_datelife_query(“cetacea”)
whale_query <- make_datelife_query("cetacea")
whale_query
whale_query <- make_datelife_query("cetacea", get_spp_from_taxon = )
whale_query <- make_datelife_query("cetacea", get_spp_from_taxon = TRUE)
whale_result <- get_datelife_result(whale_query)
whale_sdm_matrix <- get_sdm_matrix(datelife_result = whale_result)
which(sdm_matrix < 0)
which(whale_sdm_matrix < 0)
whale_sdm_matrix[which(whale_sdm_matrix <0 )]
get_summ_trees() <- function(best_grove){
tmean <- summary_matrix_to_phylo(summ_matrix = best_grove, use = "mean", target_tree = NULL)
tmin <- summary_matrix_to_phylo(summ_matrix = best_grove, use = "min", target_tree = NULL)
tmax <- summary_matrix_to_phylo(summ_matrix = best_grove, use = "max", target_tree = NULL)
res <- c(tmean, tmin, tmax)
names(res) <- c("mean_tree", "min_tree", "max_tree")
return(res)
}
get_summ_trees <- function(best_grove){
tmean <- summary_matrix_to_phylo(summ_matrix = best_grove, use = "mean", target_tree = NULL)
tmin <- summary_matrix_to_phylo(summ_matrix = best_grove, use = "min", target_tree = NULL)
tmax <- summary_matrix_to_phylo(summ_matrix = best_grove, use = "max", target_tree = NULL)
res <- c(tmean, tmin, tmax)
names(res) <- c("mean_tree", "min_tree", "max_tree")
return(res)
}
loadd(tax_bestgroveall)
i
summ_trees = get_summ_trees(tax_bestgroveall[[i]]$best_grove)
source("R/global_packages.R")
summ_trees = get_summ_trees(tax_bestgroveall[[i]]$best_grove)
tax_bestgroveall[[i]]$best_grove
sdm_summtrees = get_summ_trees(tax_sdm_phyloall[[i]])
tax_sdm_phyloall[[i]]
sdm_summtrees = get_summ_trees(tax_sdm_matrixall[[i]])
sdm_summtrees
names(sdm_summtrees)
median_summtrees = get_summ_trees(tax_median_matrixall[[i]])
median_summtrees
plot(sdm_summtrees)
source("R/functions_plotting.R")
tax_phyloall
make_lttplot_summtrees(taxa[i], tax_phyloall, tax_datedotol,
summ_trees = sdm_summtrees,
legend_summtrees = "SDM")
source("R/functions_plotting.R")
make_lttplot_summtrees(taxa[i], tax_phyloall, tax_datedotol,
summ_trees = sdm_summtrees,
legend_summtrees = "SDM")
taxon[i]
colors()
# make_phylobars_plot <-
grep("green", colors())
# make_phylobars_plot <-
colors[grep("green", colors())]
# make_phylobars_plot <-
colors()[grep("green", colors())]
source("R/functions_plotting.R")
make_lttplot_summtrees(taxa[i], tax_phyloall, tax_datedotol,
summ_trees = sdm_summtrees,
legend_summtrees = "SDM")
negs_list
colors()[grep("blue", colors())]
source("R/functions_plotting.R")
i
make_lttplot_summtrees(taxa[i], tax_phyloall, tax_datedotol,
summ_trees = sdm_summtrees,
legend_summtrees = "SDM")
source("R/functions_plotting.R")
make_lttplot_summtrees(taxa[i], tax_phyloall, tax_datedotol,
summ_trees = sdm_summtrees,
legend_summtrees = "SDM")
source("R/functions_plotting.R")
make_lttplot_summtrees(taxa[i], tax_phyloall, tax_datedotol,
summ_trees = sdm_summtrees,
legend_summtrees = "SDM")
